<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>scribe</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    @font-face {
      font-family: 'OfficeTimes';
      src: url('OfficeTimesRound-RoundMono.otf') format('opentype');
    }

    @font-face {
      font-family: 'Social';
      src: url('ABCSocialCyrillic-Regular-Trial.woff') format('woff');
    }

    @font-face {
      font-family: 'Diatype';
      src: url('ABCDiatypeMonoVariable-Trial.woff') format('woff');
    }

    body {
      font-family: 'Diatype', serif;
      font-size: 16px;
      margin: 0;
      line-height: 1.6;
      color: #191919;
      background-color: #fffaee;
    }

    /* --- Layout --- */
    .layout {
      display: flex;
      flex-direction: row;
      align-items: flex-start;
      justify-content: center;
      gap: 2rem;
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
      box-sizing: border-box;
    }

    .About {
      width: 300px;
      flex-shrink: 0;
      padding: 10px;
      position: sticky;
      top: 2rem;
      align-self: flex-start;
      height: fit-content;
    }

    .main-content {
      flex: 1;
      max-width: 700px;
    }

    /* --- Scrollable prompt feed --- */
    #prompts {
      overflow-y: auto;
      padding: 1rem 2rem;
      margin: 1rem 0;
      width: 100%;
      box-sizing: border-box;
      height: 60vh;
      min-height: 300px;
      border-top: 1px solid rgba(0,0,0,0.1);
      border-bottom: 1px solid rgba(0,0,0,0.1);
    }

    .prompt-entry {
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      font-family: 'Social', serif;
      font-size: 0.9rem;
    }

    .prompt-entry small {
      display: block;
      font-size: 0.85rem;
      text-transform: lowercase;
      color: #C2BCAA;
      font-weight: 350;
      font-family: 'Diatype', serif;
      margin-bottom: 0.25rem;
    }

    form {
      max-width: 700px;
      width: 100%;
      margin: 0 auto;
      padding: 2rem 2rem 2rem;
      box-sizing: border-box;
      font-family: 'Social', serif;
      font-size: 0.85rem;
    }

    input, textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 0.75rem;
      margin-top: 0.25rem;
      border: 1px solid #E1DBC9;
      border-radius: 2px;
      font-family: 'Social', serif;
      font-size: 0.85rem;
      background-color: #fffaee;
      resize: vertical;
    }

    button {
      padding: 0.6rem 1.2rem;
      background: #191919;
      color: #fffaee;
      font-family: 'Social', serif;
      font-size: 0.8rem;
      border-radius: 50px;
      cursor: pointer;
    }
    button:hover { opacity: 0.5; }

    /* --- Mobile view --- */
    @media(max-width: 800px) {
      .layout { flex-direction: column; }
      .About {
        position: static;
        width: 100%;
        padding: 1rem 0;
      }
      header, p, h1, form, #prompts { padding: 0 1rem; }
    }
  </style>
</head>
<body>

  <div class="layout">
    <!-- About section -->
    <div class="About">
      <p>Scribe is a literary platform in early development, intended as a curated, quieter space for meditating upon queer identity and the complex emotions that can often accompany it.</p> 
      <br>
      <p>Each prompt draws from the work of queer thinkers, writers, essayists, and artists, presenting their core principles and valuable insights as starting points for reflection. If this speaks to you, perhaps try a little Scribe.</p>
      <br>
      <p>This prompt invites you to reflect on the parts of yourself that remain hidden and whether they now long to be seen.</p>
    </div>

    <!-- Prompts + form -->
    <div class="main-content">
      <section id="prompts"></section>

      <section>
        <form id="prompt-form">
          <label>
            <strong>Name</strong>
            <input type="text" name="name" placeholder="Audre, Rita, You" required>
          </label>
          <br>
          <label>
            <strong>Location</strong>
            <input type="text" name="location" placeholder="London, Bedroom, Moon" required>
          </label>
          <br>
          <label>
            <strong>Your love and how they make you feel</strong>
            <textarea name="response" placeholder="Reveal, or don't" required></textarea>
          </label>
          <button type="submit">Submit</button>
        </form>
      </section>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyBp2QOnTd_0PtX1PCivKLozg9vGIz5OLzQ",
      authDomain: "scribe-61849.firebaseapp.com",
      projectId: "scribe-61849",
      storageBucket: "scribe-61849.appspot.com",
      messagingSenderId: "209905470454",
      appId: "1:209905470454:web:118eceef8d217556cdd5d7"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const form = document.getElementById('prompt-form');
    const prompts = document.getElementById('prompts');

    console.log("Firebase initialized:", firebase.apps.length);

    db.collection('prompts')
      .get()
      .then(snap => console.log("Prompts loaded:", snap.size))
      .catch(console.error);

    function formatDate(date) {
      const options = { month: '2-digit', day: '2-digit' };
      const datePart = date.toLocaleDateString('en-US', options).replace(/\//g, '.');
      const timePart = date.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' });
      return `${datePart} 路 ${timePart}`;
    }

    // Submit handler
    form.addEventListener('submit', async e => {
      e.preventDefault();
      const name = form.name.value.trim();
      const location = form.location.value.trim();
      const response = form.response.value.trim();

      if (!name || !location || !response) {
        alert("Please fill out all fields.");
        return;
      }

      await db.collection('prompts').add({
        name,
        location,
        response,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      form.reset();
    });

    // Real-time listener
    db.collection('prompts')
      .orderBy('timestamp', 'desc')
      .onSnapshot(snapshot => {
        console.log("Snapshot received:", snapshot.size, "documents");
        prompts.innerHTML = '';

        if (snapshot.empty) {
          prompts.innerHTML = '<p style="opacity:0.5;font-family:sans-serif;">No entries yet.</p>';
          return;
        }

        snapshot.forEach(doc => {
          const data = doc.data();
          const div = document.createElement('div');
          div.className = 'prompt-entry';
          const date = data.timestamp ? data.timestamp.toDate() : new Date();
          div.innerHTML = `
            <small>${formatDate(date)} 路 ${data.location}</small>
            <p><strong>${data.name}:</strong> ${data.response}</p>
          `;
          prompts.appendChild(div);
        });

        // Smooth scroll to top
        prompts.scrollTo({ top: 0, behavior: 'smooth' });
      });

    // TEMP TEST ENTRIES (remove once Firestore works)
    document.addEventListener('DOMContentLoaded', () => {
      if (prompts.children.length === 0) {
        for (let i = 0; i < 10; i++) {
          const div = document.createElement('div');
          div.className = 'prompt-entry';
          div.innerHTML = `<small>10.${String(i + 1).padStart(2, '0')} 路 8:${i} PM 路 Test City</small>
                           <p><strong>Tester:</strong> Example entry ${i + 1}</p>`;
          prompts.appendChild(div);
        }
      }
    });
  </script>
</body>
</html>
